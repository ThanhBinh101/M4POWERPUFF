<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M3PowerPuff</title>
    {% load static%}
    <link rel="icon" type="image/x-icon" href="{%static 'logo.png'%}">

    <link rel="stylesheet" type ="text/css" href="{%static 'patientdoctorview.css'%}">

    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">

    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>
    <header>
        <div class = "logo-name">
            <img src="{%static 'logo.png'%}" alt="">
            <a href='{% url 'mainpage' %}'>M3PowerPuff</a>
        </div>

        <ul class = "navlist">
            <li><a href="">Home</a></li>
            <li><a href="">Services</a></li>
            <li><a href="">Doctors</a></li>
            <li><a href="">About us</a></li>
            <li><a href="">Contact us</a></li>
        </ul>

        <button type="button" id="go-back" class="btn btn-primary" data-bs-toggle="modal">
            Return
        </button>

    </header>

    <section class = "displaybox">
        <div class = "textbox">
            <h2>Patient Information</h2>
            <div class = "textboxIDDoc">
                <h6>Patient ID*</h6>
                <p id = "PatientID">{{patient.id}}</p>
            </div>
            <h6>Name</h6>
            <p id = "PatientName">{{patient.name}}</p>
            <h6>Gender</h6>
            <p id = "PatientGender">{{patient.gender}}</p>
            <h6>Date of Birth</h6>
            <p id = "PatientDOB">{{patient.dateofbirth}}</p>
            <h6>Gmail</h6>
            <p id = "PatientGmail">{{patient.gmail}}</p>
        </div> 

        <div class = 'addprescription'>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal">
                <a href='newprescription/{{patient.id}}'>Add new prescription</a>
            </button>
        </div>

    </section>
  
    <section class = "MedicalRecord">
        <div class = "textbox">
            <h2>Medical History</h2>
        </div> 
        <div class="table-wrapper">
            <table class="table table-bordered custom-table">
                <thead>
                    <tr class="table-danger">
                        <th class = "align" style="width: 30%" scope="col">Date</th>
                        <th class = "align" style="width: 40%" scope="col">Diagnose</th>
                        <th class = "align" style="width: 30%" scope="col">Medical Record</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in patient.medicalrecord %}
                    <tr class="table-danger">
                        <td class = "align">{{ record.date }}</td>
                        <td class = "align">{{ record.diagnose }}</td>
                        <td class = "align">
                            <button class="ri-eye-line" type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal{{ forloop.counter }}"></button>
                            <div class="modal fade" id="exampleModal{{ forloop.counter }}" tabindex="-1" aria-labelledby="exampleModalLabel{{ forloop.counter }}" aria-hidden="true" style="width: 100%">
                                <div class="modal-dialog modal-xl">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title" id="exampleModalLabel{{ forloop.counter }}">Medical Record</h4>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="basicinfo">
                                                <h6>Status: {{ record.status }}</h6>
                                                <h6>Revisit Day: {{ record.revisit }}</h6>
                                                <h5>Prescription History</h5>
                                                <div class="tablePrescription">
                                                    <table class="table table-bordered prescription-table">
                                                        <thead>
                                                            <tr class="table-danger">
                                                                <th scope="col">Date</th>
                                                                <th scope="col">Revisit</th>
                                                                <th scope="col">Doctor</th>
                                                                <th scope="col">Status</th>
                                                                <th scope="col">Prescription</th>
                                                                <th scope="col">Note</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {% for pre in record.prescription%}
                                                            <tr class="table-danger">
                                                                <td>{{pre.date}}</td>
                                                                <td>{{pre.revisit}}</td>
                                                                <td>{{pre.doctorname}}</td>
                                                                <td>{{pre.status}}</td>
                                                                <td>
                                                                {% for med in pre.medicinelist  %}
                                                                 {{med.name}} : {{med.quantity}} <br>
                                                                {% endfor %}
                                                                </td>
                                                                <td>{{pre.note}}</td>
                                                            </tr>
                                                            {% endfor %}
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

</body>

<script>
    document.getElementById("go-back").addEventListener("click", () => {
        history.back();
      });
</script>
</html>